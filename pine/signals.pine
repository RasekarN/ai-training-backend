//@version=5
indicator("AI Quant Signal Engine", overlay=true)

// Import pattern code from detector
pattern = request.security(syminfo.tickerid, timeframe.period, close("AI Quant Pattern Detector", "Pattern Code"))

// ML probability from webhook (optional)
ml_prob = input.float(0.50, "AI Probability (Webhook)", minval=0, maxval=1)

// -------------------------
// SIGNAL LOGIC
// -------------------------
isBuy = pattern == 2 and ml_prob > 0.65
isStrongBuy = pattern == 2 and ml_prob > 0.80

isSell = pattern == -2 and ml_prob < 0.35
isStrongSell = pattern == -2 and ml_prob < 0.20

// -------------------------
// PLOT SIGNALS ON CHART
// -------------------------
plotshape(isBuy, title="BUY", style=shape.labelup, color=color.new(color.green, 0), text="BUY", size=size.small)
plotshape(isStrongBuy, title="STRONG BUY", style=shape.labelup, color=color.green, text="STRONG BUY", size=size.large)

plotshape(isSell, title="SELL", style=shape.labeldown, color=color.red, text="SELL", size=size.small)
plotshape(isStrongSell, title="STRONG SELL", style=shape.labeldown, color=color.new(color.red, 0), text="STRONG SELL", size=size.large)

// -------------------------
// ALERT CONDITIONS
// -------------------------
alertcondition(isBuy, "BUY Signal", "BUY Opportunity")
alertcondition(isStrongBuy, "STRONG BUY", "STRONG BUY SIGNAL")

alertcondition(isSell, "SELL Signal", "SELL Opportunity")
alertcondition(isStrongSell, "STRONG SELL", "STRONG SELL SIGNAL")
